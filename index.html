<!DOCTYPE html>
<html>
    <head>
        
        <!-- #include file="includes_header.html" -->

         <!-- DataTables -->
        <link href="assets/plugins/datatables/jquery.dataTables.min.css" rel="stylesheet" type="text/css" />
        <link href="assets/plugins/datatables/buttons.bootstrap.min.css" rel="stylesheet" type="text/css" />
        <link href="assets/plugins/datatables/fixedHeader.bootstrap.min.css" rel="stylesheet" type="text/css" />
        <link href="assets/plugins/datatables/responsive.bootstrap.min.css" rel="stylesheet" type="text/css" />
        <link href="assets/plugins/datatables/dataTables.bootstrap.min.css" rel="stylesheet" type="text/css"/>
        <link href="assets/plugins/datatables/scroller.bootstrap.min.css" rel="stylesheet" type="text/css" />

        <!-- Libreria inicial para datepicker -->
        <link href="assets/plugins/bootstrap-datepicker/css/bootstrap-datepicker.min.css" rel="stylesheet">

    </head>


    <body class="fixed-left">

        <!-- Begin page -->
        <div id="wrapper">

            <!-- #include file="header.html" -->

            <!-- Start right Content here -->
            <div class="content-page">
                <!-- Start content -->
                <div class="content">

                    <div class="">
                        <div class="page-header-title">
                            <h4 class="page-title">Dashboard</h4>
                        </div>
                    </div>

                    <div class="page-content-wrapper ">

                        <div class="container">

                            <div class="row">
                                <div class="col-sm-6 col-lg-4">
                                    <div class="panel text-center">
                                        <div class="panel-heading">
                                            <h4 class="panel-title text-muted font-light"><a href="tables-datatable-project.html" style="color: #9fa2a7"> Proyectos</a></h4>
                                        </div>
                                        <div class="panel-body p-t-10">
                                            <h2 class="m-t-0 m-b-15"><i class="mdi mdi-checkbox-blank-circle m-r-10" style="color: lightblue"></i><b id="Proyectos-Totales"></b></h2>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-sm-6 col-lg-4">
                                    <div class="panel text-center">
                                        <div class="panel-heading">
                                            <h4 class="panel-title text-muted font-light">Proyectos en Progreso</h4>
                                        </div>
                                        <div class="panel-body p-t-10">
                                            <h2 class="m-t-0 m-b-15"><i class="mdi mdi-checkbox-blank-circle-outline m-r-10" style="color:yellow"></i><b id="Proyectos-Prog"></b></h2>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-sm-6 col-lg-4">
                                    <div class="panel text-center">
                                        <div class="panel-heading">
                                            <h4 class="panel-title text-muted font-light">Proyectos Completados</h4>
                                        </div>
                                        <div class="panel-body p-t-10">
                                            <h2 class="m-t-0 m-b-15"><i class="mdi mdi-checkbox-marked-circle m-r-10" style="color: lightgreen"></i><b id="Proyectos-Terminados"></b></h2>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                


                                <!-- Progreso de Proyectos-->
                                <div class="col-md-6">
                                    <div id="goal" class="panel">
                                        <div class="panel-body">
                                            <h4  class="m-b-30 m-t-0">Goal Completion</h4>
		                                    <div id="tablaProyectos" class="m-b-30">
		                                    	<!-- Aqui van los proyectos insertados dinamicamente -->
		                                    </div>

                                            <span></span>

                                            <div class="col-xs-12 col-sm-12 m-b-30">
                                                <div class="form-group">
                                                                <label>Nombre</label>
                                                                <input type="text" id="nombre" class="form-control" required
                                                                       placeholder="Nombre del Proyecto"/>
                                                </div>

                                                <div class="form-group">
                                                                <label>Descripción</label>
                                                                <input type="text" id="descripcion" class="form-control" rows="5" required
                                                                       placeholder="Descripción del Proyecto"/>
                                                </div>

                                                 <label>Deadline:</label>
                                                <div id="deadline" class="form-group">
                                                    <div id="deadline" class="form-group">
                                                        <div class="form-group">
                                                            <div class="input-group">
                                                                <input id="datepicker-autoclose" readonly="true" type="text" class="form-control" placeholder="" data-date-format="D d M yyyy" onclick="highlightDeadline()">
                                                                <span class="input-group-addon bg-custom b-0"><i class="mdi mdi-calendar"></i></span>
                                                            </div><!-- input-group -->
                                                        </div>
                                                    </div>
                                                </div>
                                                

                                                <p id = "btnPorcentaje" class="text-muted" type= "button" style="margin-top: 1.5em"></p>
                                                <button id="btnNuevoProyecto" type="button" class="btn btn-default waves-effect" >Nuevo Proyecto</button>
                                            </div>
                                        </div>
                                    </div>
                                </div> <!-- end col -->


                                <!--Lista de Pendientes-->
                                <div class="col-md-6">
                                    <div class="panel">
                                        <div class="panel-body">
                                        <h5>Lista de Pendientes</h5>
                                            <div id="listaPendientes" class="list-group">
                                                <!-- Aqui van los pendientes insertados dinamicamente -->
                                            </div>

                                            <div class="form-group">
                                                            <label>Nombre</label>
                                                            <input type="text" id="nombrePendiente" class="form-control" required
                                                                   placeholder="Nombre del Pendiente"/>
                                            </div>

                                            <label>Tipo de Prioridad</label>
                                                <div>
                                                    <div class="radio radio-danger radio-inline">
                                                        <input type="radio" id="inlineRadio" value="Alta" name="radioInline" checked="checked">
                                                        <label style="pointer-events: none" for="inlineRadio1"> Alta </label>
                                                    </div>

                                                    <div class="radio radio-warning radio-inline">
                                                        <input type="radio" id="inlineRadio" value="Media" name="radioInline">
                                                        <label style="pointer-events: none" for="inlineRadio2"> Media </label>
                                                    </div>

                                                    <div class="radio radio-info radio-inline">
                                                        <input type="radio" id="inlineRadio2" value="Baja" name="radioInline">
                                                        <label style="pointer-events: none"for="inlineRadio"> Baja </label>
                                                    </div>
                                                </div id="log">

                                            <p id = "btnPendiente" class="text-muted" type= "button" style="margin-top: 1.5em"></p>
                                                <button id="btnNuevoPendiente" type="button" class="btn btn-default waves-effect" >Nuevo Pendiente</button>
                                        </div>
                                    </div> <!-- list-group -->
                                </div> <!-- col -->
                            </div>
                            <!-- end row -->

                        </div><!-- container -->


                    </div> <!-- Page content Wrapper -->

                </div> <!-- content -->

                <footer class="footer">
                     2018 - Juguel Uniformes
                </footer>

            </div>
            <!-- End Right content here -->

        </div>
        <!-- END wrapper -->


        <!-- jQuery  -->
        <script src="assets/js/jquery.min.js"></script>
        <script src="assets/js/bootstrap.min.js"></script>
        <script src="assets/js/modernizr.min.js"></script>
        <script src="assets/js/detect.js"></script>
        <script src="assets/js/fastclick.js"></script>
        <script src="assets/js/jquery.slimscroll.js"></script>
        <script src="assets/js/jquery.blockUI.js"></script>
        <script src="assets/js/waves.js"></script>
        <script src="assets/js/wow.min.js"></script>
        <script src="assets/js/jquery.nicescroll.js"></script>
        <script src="assets/js/jquery.scrollTo.min.js"></script>

        <script src="assets/pages/dashborad.js"></script>

        <script src="assets/js/app.js"></script>

        <!-- Datatables-->
        <script src="assets/plugins/datatables/jquery.dataTables.min.js"></script>
        <script src="assets/plugins/datatables/dataTables.bootstrap.js"></script>
        <script src="assets/plugins/datatables/dataTables.buttons.min.js"></script>
        <script src="assets/plugins/datatables/buttons.bootstrap.min.js"></script>
        <script src="assets/plugins/datatables/jszip.min.js"></script>
        <script src="assets/plugins/datatables/pdfmake.min.js"></script>
        <script src="assets/plugins/datatables/vfs_fonts.js"></script>
        <script src="assets/plugins/datatables/buttons.html5.min.js"></script>
        <script src="assets/plugins/datatables/buttons.print.min.js"></script>
        <script src="assets/plugins/datatables/dataTables.fixedHeader.min.js"></script>
        <script src="assets/plugins/datatables/dataTables.keyTable.min.js"></script>
        <script src="assets/plugins/datatables/dataTables.responsive.min.js"></script>
        <script src="assets/plugins/datatables/responsive.bootstrap.min.js"></script>
        <script src="assets/plugins/datatables/dataTables.scroller.min.js"></script>

        <!-- Datatable init js -->
        <script src="assets/pages/datatables.init.js"></script>

        <script src="assets/js/Proyectos.js"></script>

        <script src="assets/js/ProyectosProg.js"></script>

        <script src="assets/js/ProyectosTerminados.js"></script>

        <!-- Plugins js -->
        <script src="assets/plugins/timepicker/bootstrap-timepicker.js"></script>
        <script src="assets/plugins/bootstrap-colorpicker/js/bootstrap-colorpicker.min.js"></script>
        <script src="assets/plugins/bootstrap-datepicker/js/bootstrap-datepicker.min.js"></script>

        <!-- Plugins Init js -->
        <script src="assets/pages/form-advanced.js"></script>


        <!--Tabla de datatable-contactos-->
        <script type="text/javascript">
            var Contactos = Parse.Object.extend("Contactos");
            var query = new Parse.Query(Contactos);
            //query.equalTo("User", true);
            query.find({
              success: function(results) {
                var table = $('#datatable-buttons').DataTable();
                // Do something with the returned Parse.Object values
                for (var i = 0; i < results.length; i++) {
                    var object = results[i];                    
                    var data = [];
                    data.push(String(object.get("Nombre")));
                    data.push(String(object.get("Encargado"))); 
                    data.push(String(object.get("Departamento")));
                    data.push( object.get("Correo") == null? "-" : String(object.get("Correo")));
                    data.push( object.get("Numero") == null? "-" : String(object.get("Numero")));
                    table.row.add(data).draw();
                }
              },
              error: function(error) {
                alert("Error: " + error.code + " " + error.message);
              }
            });
        </script>

        <!--Traer proyectos de parse y crear nuevos con boton-->
        <script type="text/javascript">
        	var Proyectos = Parse.Object.extend("Proyectos");
				var query = new Parse.Query(Proyectos);
				query.equalTo("Terminado",false);
                query.ascending("Deadline");
				query.find({
					success: function(results) {
					 	for (var i = 0; i < results.length; i++){
                                var fechaHoy = new Date();
                                var deadlineProyecto = results[i].get("Deadline");
                                var typeBar = "primary";
                                if (fechaHoy.getTime() > deadlineProyecto.getTime()){
                                    typeBar = "danger";
                                }
    					 		var proyecto = '<p class="font-600 m-b-5"><a href="ui-alerts.html?'+ String(results[i].id) +'" style="color:white"	>' + results[i].get("Nombre") +  '</a><span  class="text-primary pull-right"><b>'+ results[i].get("Progreso") +'%</b></span></p><div class="progress  m-b-20"> \
    				                <div class="progress-bar progress-bar-' + typeBar + ' progress-bar-striped active" role="progressbar" aria-valuenow="'+ results[i].get("Progreso") +'" aria-valuemin="0" aria-valuemax="100" style="width: '+ results[i].get("Progreso") +'%;"> \
    				                </div><!-- /.progress-bar .progress-bar-danger -->\
    				            </div><!-- /.progress .no-rounded -->'
    				    		$("#tablaProyectos").append(proyecto);
						}
					}
				});

			//Boton para agregar nuevos proyectos
        	$("#btnNuevoProyecto").click(function(){
        		var nombre = document.getElementById('nombre').value;
                alert(nombre.toString());
                if (nombre == '') {}
                else{
                        var fecha = $("#datepicker-autoclose").datepicker("getDate");
                        var desc = document.getElementById('descripcion').value;
                        var claseProyectos = Parse.Object.extend("Proyectos");
                        var object = new claseProyectos();
        	    		object.set("Nombre",nombre);
                        object.set("Descripcion",desc)
        	    		object.set("Progreso",0);
        	    		object.set("Terminado",false);
                        object.set("Deadline",fecha);
        	    		object.save(null, {
        				  success: function(result) {
        				    // Execute any logic that should take place after the object is saved.
        	    			var proyecto = '<p class="font-600 m-b-5"><a href="ui-alerts.html?'+ result.id +'" style="color:white"  >' + nombre + '</a><span class="text-primary pull-right"><b>0%</b></span></p><div class="progress  m-b-20"> \
                            <div class="progress-bar progress-bar-primary progress-bar-striped active" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%;">\
                            </div><!-- /.progress-bar .progress-bar-danger -->\
                        </div><!-- /.progress .no-rounded -->'
                            $("#tablaProyectos").append(proyecto);
        				  },
        				  error: function(result, error) {
        				    // Execute any logic that should take place if the save fails.
        				    // error is a Parse.Error with an error code and message.
        				    alert('Error al guardar: ' + error.message);
        				  }
        				});
                }
            });
        </script>

        <!--Traer pendientes de parse-->
        <script type="text/javascript">
            var Pendientes = Parse.Object.extend("Pendientes");
            var pendientes;
            var query = new Parse.Query(Pendientes);
            query.equalTo("Terminado",false);
            query.ascending("Orden");
            query.find({
                success: function(results) {
                    for (var i = 0; i < results.length; i++){
                        if(results[i].get("Prioridad") == "Alta"){
                            pendientes = '<a href="pendientes.html?' + String(results[i].id) + '" class="list-group-item list-group-item-action list-group-item-danger prioridad-alta" style="color:#e66060;">'+ results[i].get("Pendiente") + '</a>'
                        }
                        else if(results[i].get("Prioridad") == "Media"){
                            pendientes = '<a href="pendientes.html?' + String(results[i].id) + '" class="list-group-item list-group-item-action list-group-item-warning prioridad-media" style="color:#ffb600;">'+ results[i].get("Pendiente") + '</a>'
                        }
                        else if(results[i].get("Prioridad") == "Baja"){
                            pendientes = '<a href="pendientes.html?' + String(results[i].id) + '" class="list-group-item list-group-item-info prioridad-baja" style="color:#00a4fe;">'+ results[i].get("Pendiente") + '</a>'
                        }
                            $("#listaPendientes").append(pendientes);
                    }
                }
            });
        </script>

        <!--Boton para agregar nuevos pendientes-->
        <script type="text/javascript">
            $("#btnNuevoPendiente").click(function(){
                var proyecto;
                var nombre = document.getElementById('nombrePendiente').value;
                var prior = $( "input:checked" ).val();
                alert(nombre.toString());
                if (nombre == '') {}
                else{
                        if(prior == "Alta"){
                            proyecto = '<a href="javascript:void(0)" class="list-group-item list-group-item-action list-group-item-danger prioridad-alta" style="color:#e66060;">'+ nombre + '</a>'
                        }
                        else if(prior == "Media"){
                            proyecto = '<a href="javascript:void(0)" class="list-group-item list-group-item-action list-group-item-warning prioridad-media" style="color:#ffb600;">'+ nombre + '</a>'
                        }
                        else if(prior == "Baja"){
                            proyecto = '<a href="javascript:void(0)" class="list-group-item list-group-item-danger prioridad-baja" style="color:#00a4fe;">'+ nombre + '</a>'
                        }
                        var clasePendientes = Parse.Object.extend("Pendientes");
                        var object = new clasePendientes();
                        object.set("Pendiente",nombre);
                        object.set("Prioridad",prior);
                        object.set("Progreso",0);
                        object.set("Terminado",false);
                        if(prior == "Alta"){
                            object.set("Orden",1);
                        }
                        else if(prior == "Media"){
                            object.set("Orden",2);
                        }
                        else if(prior == "Baja"){
                           object.set("Orden",3);
                        }
                        object.save(null, {
                          success: function(result) {
                            // Execute any logic that should take place after the object is saved.
                            $("#listaPendientes").append(proyecto);
                            location.reload();
                          },
                          error: function(result, error) {
                            // Execute any logic that should take place if the save fails.
                            // error is a Parse.Error with an error code and message.
                            alert('Error al guardar: ' + error.message);
                          }
                        });
                }
            });
        </script>



<!--Comments Button-->
        <script type="text/javascript">
            $("#btnComentario").click(function(){
                var nom = $('#nombre').val();
                var porc = parseInt($('#porcentaje').val());
                var pro = $('#comentario').val();
                var cambioFecha = $("#myCheck")[0].checked;
                var fecha = $("#datepicker-autoclose").datepicker("getDate");
                var claseProyectos = Parse.Object.extend("Proyectos");
                
                // Creamos y guardamos el comentario
                var claseEventos = Parse.Object.extend("EventosProyectos"); 
                var comentario = new Parse.Object("EventosProyectos");
                comentario.set("Nombre",nom);
                comentario.set("Comentario",pro);
                comentario.set("Porcentaje", porc);
                comentario.set("CambiaDeadline",cambioFecha);
                comentario.set("Deadline",fecha);
                comentario.save({
                    success: function(result) {
                        var query = new Parse.Query(claseProyectos);
                        var url = document.URL;
                        var objectId = url.substr(url.indexOf("?")+1);
                        query.get(objectId,{
                            success: function(result) {
                                var eventos = result.relation("Eventos");
                                //eventos.add("Nombre",nom);
                                eventos.add(comentario);
                                result.set("Progreso", porc);
                                result.set("Terminado", porc==100);
                                if (cambioFecha){
                                    result.set("Deadline",fecha);
                                }
                                result.save({
                                    success: function(result) {
                                        location.reload();
                                        },
                                    error: function(error) {
                                        alert("Error: " + error.code + " " + error.message);
                                    }
                                });
                            },
                            error: function(error) {
                                alert("Error: " + error.code + " " + error.message);
                            }
                        });
                        },
                    error: function(error) {
                        alert("Error: " + error.code + " " + error.message);
                    }
                });
            });
        </script>




        <link href="assets\css\listaStyle.css" rel="stylesheet" type="text/css" />
    </body>
</html>